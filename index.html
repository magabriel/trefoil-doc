<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content=""/>
    <meta name="date" content="02/03/2014"/>
    <meta name="generator" content="trefoil DEV"/>

    <title>Trefoil documentation</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">

    <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>

            <link rel="stylesheet" href="css/easybook.css"/>
    
            <link rel="stylesheet" href="css/styles.css"/>
    </head>

<body data-spy="scroll" data-target=".sidebar">
<div class="container">

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">trefoil</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="http://github.com/magabriel/trefoil" target="_blank">Code</a></li>
                <li><a href="http://easybook-project.org" target="_blank">Easybook docs</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron">
    <h1>Trefoil documentation</h1>
    <h2></h2>
</div>        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            





<div class="sidebar" data-spy="affix" data-offset-top="230" data-offset-bottom="100">

    <ul class="nav sidenav">
        
        
                                                            
                        
                
                
                
                
                                
                                        
                    
                    
                                                                                                                                                                                    <li><!-- level 1 -->
                                <a href="#introduction">
             Introduction
        </a>
                                                    
                                            
                
                                        
                    
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#license">
             License
        </a>
                                                    
                                            
                
                                        
                    
                    
                
                                        
                    
                    
                
                                        
                    
                    
                
                                        
                    
                    
                
                                    </li><!-- level 2 -->
                                                                        </ul><!-- level 2 -->
                                                                                                        
                                                        
                        
                
                
                
                                                                                            
                                
                                        
                    
                    
                                                                                                                                                                                    <li><!-- level 1 -->
                                <a href="#about-trefoil"><span>Part 1</span> -  About Trefoil
        </a>
                                                    
                                            
                
                
                                                        
                        
                
                                                    
                
                
                                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#about-this-project"><span>Chapter 1</span> -  About this project
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 3 -->
                                                                <li><!-- level 3 -->
                                <a href="#installing">
             Installing
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#extending-easybook">
             Extending Easybook
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                    </li><!-- level 3 -->
                                                                        </ul><!-- level 3 -->
                                                                                                </ul><!-- level 2 -->
                                                            
                                                        
                        
                
                
                
                                                                                </li><!-- level before part -->
                                                        
                                
                                        
                    
                    
                                                                                                                                                                                    <li><!-- level 1 -->
                                <a href="#trefoil-plugins"><span>Part 2</span> -  Trefoil plugins
        </a>
                                                    
                                            
                
                
                                                        
                        
                
                                                    
                
                
                                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#plugin-system-enhancements"><span>Chapter 2</span> -  Plugin system enhancements
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 3 -->
                                                                <li><!-- level 3 -->
                                <a href="#namespaces-for-plugins">
             Namespaces for plugins
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#selectively-enabling-optional-plugins">
             Selectively enabling optional plugins
        </a>
                        
                                            
                
                                    </li><!-- level 3 -->
                                                                        </ul><!-- level 3 -->
                                                                                                </ul><!-- level 2 -->
                                                            
                                                        
                        
                
                                                    
                
                
                                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#the-trefoil-book-formatting-plugins"><span>Chapter 3</span> -  The Trefoil book formatting plugins
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 3 -->
                                                                <li><!-- level 3 -->
                                <a href="#dropcapsplugin">
             DropCapsPlugin
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#footnotesextraplugin">
             FootnotesExtraPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#htmltweaksplugin">
             HtmlTweaksPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#imageextraplugin">
             ImageExtraPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#kindletweaksplugin">
             KindleTweaksPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#tableextraplugin">
             TableExtraPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#typographyplugin">
             TypographyPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#twigextensionplugin">
             TwigExtensionPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                    </li><!-- level 3 -->
                                                                        </ul><!-- level 3 -->
                                                                                                </ul><!-- level 2 -->
                                                            
                                                        
                        
                
                                                    
                
                
                                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#the-trefoil-utility-plugins"><span>Chapter 4</span> -  The Trefoil utility plugins
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 3 -->
                                                                <li><!-- level 3 -->
                                <a href="#ebookrenameplugin">
             EbookRenamePlugin
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#epubcheckplugin">
             EpubCheckPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#epubuncompressplugin">
             EpubUncompressPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#linkcheckplugin">
             LinkCheckPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#qualitycontrolplugin">
             QualityControlPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#versionupdaterplugin">
             VersionUpdaterPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                    </li><!-- level 3 -->
                                                                        </ul><!-- level 3 -->
                                                                                                </ul><!-- level 2 -->
                                                            
                                                        
                        
                
                                                    
                
                
                                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#the-trefoil-interactive-plugins"><span>Chapter 5</span> -  The Trefoil interactive plugins
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 3 -->
                                                                <li><!-- level 3 -->
                                <a href="#autoglossaryplugin">
             AutoGlossaryPlugin
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#ebookquizplugin">
             EbookQuizPlugin
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                    </li><!-- level 3 -->
                                                                        </ul><!-- level 3 -->
                                                                                                </ul><!-- level 2 -->
                                                            
                                                        
                        
                
                
                
                                                                                </li><!-- level before part -->
                                                        
                                
                                        
                    
                    
                                                                                                                                                                                    <li><!-- level 1 -->
                                <a href="#trefoil-themes"><span>Part 3</span> -  Trefoil themes
        </a>
                                                    
                                            
                
                
                                                        
                        
                
                                                    
                
                
                                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 2 -->
                                                                <li><!-- level 2 -->
                                <a href="#themes-system-enhancements"><span>Chapter 6</span> -  Themes system enhancements
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                                                                                                                                                        <ul class="nav"><!-- level 3 -->
                                                                <li><!-- level 3 -->
                                <a href="#trefoil-themes-2">
             Trefoil themes
        </a>
                                                    
                                            
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#custom-themes">
             Custom themes
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#structure-of-a-theme">
             Structure of a theme
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                                                    </li><!-- level 3 -->
                            <li><!-- level 3 -->
                            <a href="#components-of-a-theme">
             Components of a theme
        </a>
                        
                                            
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                        
                                                                                        
                    
                
                                    </li><!-- level 3 -->
                                                                        </ul><!-- level 3 -->
                                                                                                </ul><!-- level 2 -->
                                                            
                                                                                                                </ul><!-- level end part -->
    
    </ul>
</div>
        </div>

        <div class="col-md-9">
                            <div class="item edition">
    <h1 id="about-this-edition"><span></span> About this edition</h1>

    <div class="edition-data">
    <h2>Trefoil documentation</h2>    </div>

    <p><img class="logo" src="images/logo_publisher.gif" alt="" /></p>

    
        <p>Version 2014.0.858 - 201402031958</p>
    
    <p>&copy; 2014</p>

<p><em>All rights reserved.</em></p>

</div>

                            <div class="item introduction">
    <h1 id="introduction"> Introduction</h1>
 

    <p class="has-dropcaps"><span class="dropcaps">T</span>his is the documentation of <strong>trefoil</strong>, a project conceived as an extension
to <strong>easybook</strong> (<a href="http://easybook-project.org">http://easybook-project.org</a>).</p>

<p><strong>trefoil</strong> extends <strong>easybook</strong> to provide additional features for publication
of <em>ebooks</em>, both fiction and non-fiction.</p>

<div class="admonition note">
  <h5 id="note">Note</h5>
  
  <p>This documentation is a <strong>trefoil</strong> book itself, intended to be published into
  one of the supported formats.</p>
</div>

<p>To create the documentation, go to the directory where trefoil is installed and run 
one of the following commands:</p>

<p><strong>To get the <em>epub</em> version:</strong></p>

<div class="code bash">
<pre class="bash">book publish trefoil-doc ebook</pre>
</div>

<p><strong>To get the <em>kindle</em> version (please ensure you have the <code>kindlegen</code> application 
installed):</strong></p>

<div class="code bash">
<pre class="bash">book publish trefoil-doc kindle</pre>
</div>

<p><strong>To get the <em>doc-website</em> version (this one):</strong></p>

<div class="code bash">
<pre class="bash">book publish trefoil-doc doc-website</pre>
</div>

<p>Other formats may be supported, so look at 
<code>&lt;trefoil-dir&gt;/doc/trefoil-doc/config.yml</code> to see all the options available.</p>

<h2 id="license">License</h2>

<blockquote>
  <h5 id="application-code">Application Code</h5>
  
  <p>Copyright (c) 2014 Miguel Angel Gabriel <a href="&#x6d;&#x61;&#x69;&#x6c;&#116;&#111;&#58;&#109;&#97;&#x67;&#x61;&#x62;&#x72;&#x69;&#101;&#108;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#111;&#109;">&#109;&#97;&#x67;&#x61;&#x62;&#x72;&#x69;&#101;&#108;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#111;&#109;</a></p>
  
  <hr />
  
  <p>Permission is hereby granted, free of charge, to any person obtaining a copy of
  this software and associated documentation files (the &#8220;Software&#8221;), to deal in
  the Software without restriction, including without limitation the rights to
  use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
  of the Software, and to permit persons to whom the Software is furnished to do
  so, subject to the following conditions:</p>
  
  <p>The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.</p>
  
  <p>THE SOFTWARE IS PROVIDED &#8220;AS IS&#8221;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.</p>
  
  <h5 id="libraries-and-packages-used">Libraries and packages used</h5>
  
  <p>See their own license files in <code>vendor/</code> directory</p>
  
  <h5 id="resources-used">Resources used</h5>
  
  <p>See their own license files in <code>app/Resources/</code> directory</p>
</blockquote>

</div> 
                            <div class="item part">
    <h1 id="about-trefoil"><span>Part 1</span> About Trefoil</h1>
    <p>The <em>whats</em>, <em>whys</em> and <em>hows</em> of <strong>trefoil</strong>.</p>

</div>
                            <div class="item chapter">
    <h1 id="about-this-project"><span>Chapter 1</span> About this project</h1>
    <p class="has-dropcaps"><span class="dropcaps">T</span>his project aims to provide a great tool for creating ebooks.
It does that by extending the already superb <strong>easybook</strong>
(<a href="http://easybook-project.org">http://easybook-project.org</a>) to provide additional features
specifically targeted towards generation of ebooks.</p>


    <div class="btn-group visible-xs visible-sm">

                
        <button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
            In this chapter:
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#installing">
                            Installing
                    </a>
    </li>

                                                                                                                                                                                                                                            <li class="chapter level-2">
        <a href="#extending-easybook">
                            Extending Easybook
                    </a>
    </li>

                                                                                                                                                                                                                                        </ul>
    </div>


<h2 id="installing">Installing</h2>

<p>1.- Clone the trefoil repository:</p>

<div class="code bash">
<pre class="bash"><span class="kw2">mkdir</span> trefoil
<span class="kw2">git clone</span> http:<span class="sy0">//</span>github.com<span class="sy0">/</span>magabriel<span class="sy0">/</span>trefoil trefoil<span class="sy0">/</span></pre>
</div>

<p>2.- Download the vendors and dependencies:</p>

<div class="code bash">
<pre class="bash"><span class="kw3">cd</span> trefoil<span class="sy0">/</span>
php composer.phar <span class="kw2">install</span></pre>
</div>

<h2 id="extending-easybook">Extending Easybook</h2>

<p>If you are reading this, it is assumed that you are familiar with <strong>easybook</strong>
documentation. If you are not, please go to <a href="http://easybook-project.org">http://easybook-project.org</a> and 
read it. You can even install a test version of <strong>easybook</strong> and play with it
a little to gain first-hand knowledge of its capabilities. When you are done
with it you should return to this document and continue reading.</p>

<div class="admonition note">
  <h5 id="notice">NOTICE</h5>
  
  <p><strong>trefoil</strong> is not a fork of <strong>easybook</strong> but an extension.</p>
</div>

<h3 id="compatibility">Compatibility</h3>

<p><strong>trefoil</strong> has been developed as an extension of <strong>easybook</strong>, so it is fully 
backwards compatible with <strong>easybook</strong>. That means that any book prepared to be 
published by <strong>easybook</strong> should publish under <strong>trefoil</strong> without alterations.</p>

<h3 id="motivation">Motivation</h3>

<p><strong>easybook</strong> is a wonderful project that really eases auto-publishing work,
making possible to get professional results with limited knowledge or resources.
But it is primarily focused on the technical writer, lacking some features 
needed by non-technical works, both fiction and non-fiction.
While these features could of course be implemented into <strong>easybook</strong> itself, the
<em>extension</em> approach was chosen because of the progressive nature of the
development (the features were being developed as needed, during preparation
of a real book that was eventually published to <em>Amazon Kindle Store</em>). 
As such, it would have been highy impractical trying to influence <strong>easybook</strong> 
project to go the way we needed (and cope with the numerous mistakes that were 
made all over the road).</p>

<p>Looking at the <em>final</em> result, it becomes evident that some features <em>could</em>  (or 
even <em>may</em> or <em>should</em>) be integrated into <strong>easybook</strong>. As on any other open 
source project, only time will tell.</p>

</div>
                            <div class="item part">
    <h1 id="trefoil-plugins"><span>Part 2</span> Trefoil plugins</h1>
    <p>The biggest part of <strong>trefoil</strong> functionality is implemented into 
the included plugins.</p>

</div>
                            <div class="item chapter">
    <h1 id="plugin-system-enhancements"><span>Chapter 2</span> Plugin system enhancements</h1>
    <p class="has-dropcaps"><span class="dropcaps">P</span>lugins are the core of <strong>easybook</strong> 
<a href="http://easybook-project.org/documentation/chapter-9.html">extensibilty</a>. 
But considerably more flexibility was needed in order to allow implementation 
of all the needed functionality, so the first task was to extend the plugins 
system.</p>

<p>The first things to be enhanced were:</p>

<ul>
<li><p>There are no way of reusing user-created plugins other than copying
the code from one book to another.</p></li>
<li><p>Plugins are not namespaced, precluding autoloading and extensibility.</p></li>
</ul>


    <div class="btn-group visible-xs visible-sm">

                
        <button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
            In this chapter:
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#namespaces-for-plugins">
                            Namespaces for plugins
                    </a>
    </li>

                                                                                                                                                                                                                                            <li class="chapter level-2">
        <a href="#selectively-enabling-optional-plugins">
                            Selectively enabling optional plugins
                    </a>
    </li>

                                                                                                    </ul>
    </div>


<h2 id="namespaces-for-plugins">Namespaces for plugins</h2>

<p>All of <code>trefoil</code> plugins are namespaced. The <em>optional</em> plugins (more on
that later) are under the namespace (you guess) <code>Trefoil\Plugins\Optional</code>.</p>

<p>So a typical plugin now looks like:</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co1">// trefoil\src\Trefoil\Plugins\Optional\AwesomePlugin.php</span>
<span class="kw2">namespace</span> Trefoil\Plugins\Optional<span class="sy0">;</span>
&nbsp;
<span class="kw2">use</span> <span class="sy0">...;</span>
&nbsp;
<span class="kw2">class</span> AwesomePlugin <span class="kw2">extends</span> BasePlugin implements EventSubscriberInterface
<span class="br0">&#123;</span>
    <span class="kw2">public</span> static <span class="kw2">function</span> getSubscribedEvents<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="co1">//....</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">//...</span>
<span class="br0">&#125;</span></pre>
</div>

<p><code>BasePlugin</code> is a base class that provides some utility methods and
properties to plugins:</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co1">// trefoil\src\Trefoil\Plugins\BasePlugin.php</span>
<span class="kw2">namespace</span> Trefoil\Plugins<span class="sy0">;</span>
&nbsp;
<span class="kw2">use</span> Trefoil\Util\Toolkit<span class="sy0">;</span>
<span class="kw2">use</span> Easybook\Events\BaseEvent<span class="sy0">;</span>
&nbsp;
<span class="co4">/**
 * Base class for all plugins
 *
 */</span>
<span class="kw2">abstract</span> <span class="kw2">class</span> BasePlugin
<span class="br0">&#123;</span>
    <span class="kw2">protected</span> <span class="re0">$app</span><span class="sy0">;</span>
    <span class="kw2">protected</span> <span class="re0">$output</span><span class="sy0">;</span>
    <span class="kw2">protected</span> <span class="re0">$edition</span><span class="sy0">;</span>
    <span class="kw2">protected</span> <span class="re0">$format</span><span class="sy0">;</span>
    <span class="kw2">protected</span> <span class="re0">$theme</span><span class="sy0">;</span>
    <span class="kw2">protected</span> <span class="re0">$item</span><span class="sy0">;</span>
&nbsp;
    <span class="co4">/**
     * Do some initialization tasks.
     * Must be called explicitly for each plugin at the begining
     * of each event handler method.
     *
     * @param BaseEvent $event
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> init<span class="br0">&#40;</span>BaseEvent <span class="re0">$event</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">event</span> <span class="sy0">=</span> <span class="re0">$event</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">app</span> <span class="sy0">=</span> <span class="re0">$event</span><span class="sy0">-&gt;</span><span class="me1">app</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">app</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'console.output'</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">edition</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">app</span><span class="br0">&#91;</span><span class="st_h">'publishing.edition'</span><span class="br0">&#93;</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">format</span> <span class="sy0">=</span> Toolkit<span class="sy0">::</span><span class="me2">getCurrentFormat</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">app</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">theme</span> <span class="sy0">=</span> <span class="kw3">ucfirst</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">app</span><span class="sy0">-&gt;</span><span class="me1">edition</span><span class="br0">&#40;</span><span class="st_h">'theme'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">item</span> <span class="sy0">=</span> <span class="re0">$event</span><span class="sy0">-&gt;</span><span class="me1">getItem</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">//... more methods</span>
&nbsp;
<span class="br0">&#125;</span></pre>
</div>

<p>The <code>init()</code> method defines a bunch of useful properties to make them
available for the plugins.</p>

<h2 id="selectively-enabling-optional-plugins">Selectively enabling optional plugins</h2>

<p><strong>trefoil</strong> introduces the concept of <em>optional</em> plugins: each book&#8217;s 
edition can enable only certain plugins (<strong>easybook</strong> standard plugins,
on the other hand, are always enabled).</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> plugin1, plugin2, <span class="sy1">...</span><span class="br0">&#93;</span><span class="co4">
                options</span><span class="sy2">:
</span>                    <span class="sy1">...</span></pre>
</div>

<p><code>enabled</code> is a list of all the enabled plugins without the <code>Plugin</code> suffix,
so if you wanted to enable plugins <code>DropCapsPlugin</code> and <code>TableExtraPlugin</code> 
for edition <code>ebook</code> you would write:</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span>:<span class="co4">
        ebook</span>:<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> DropCaps, TableExtra <span class="br0">&#93;</span></pre>
</div>

</div>
                            <div class="item chapter">
    <h1 id="the-trefoil-book-formatting-plugins"><span>Chapter 3</span> The Trefoil book formatting plugins</h1>
    <p class="has-dropcaps"><span class="dropcaps">T</span>his chapter describes the <em>book formatting plugins</em>. These
plugins provide functionalities to enhance the book&#8217;s appearance
or to ease applying advanced formatting.</p>


    <div class="btn-group visible-xs visible-sm">

                
        <button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
            In this chapter:
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#dropcapsplugin">
                            DropCapsPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#footnotesextraplugin">
                            FootnotesExtraPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#htmltweaksplugin">
                            HtmlTweaksPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                            <li class="chapter level-2">
        <a href="#imageextraplugin">
                            ImageExtraPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="chapter level-2">
        <a href="#kindletweaksplugin">
                            KindleTweaksPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                            <li class="chapter level-2">
        <a href="#tableextraplugin">
                            TableExtraPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="chapter level-2">
        <a href="#typographyplugin">
                            TypographyPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#twigextensionplugin">
                            TwigExtensionPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </ul>
    </div>


<h2 id="dropcapsplugin">DropCapsPlugin</h2>

<p>This plugin handles adding drop caps to the book, either automatically or manually.</p>

<h3 id="availability">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> DropCaps <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co4">
                    DropCaps</span>:<span class="co3">
                        levels</span><span class="sy2">: </span>    <span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>           <span class="co3">
                        mode</span><span class="sy2">: </span>      letter        <span class="co3">
                        length</span><span class="sy2">: </span>    <span class="nu0">1</span>             <span class="co3">
                        coverage</span><span class="sy2">: </span>  <span class="br0">&#91;</span>'chapter'<span class="br0">&#93;</span></pre>
</div>

<p>where the options are:</p>

<ul>
<li><code>levels</code>: The heading levels to add drop caps after. Values 1 to 6 (default: 1).</li>
<li><code>mode</code>: Values <code>letter</code> or <code>word</code> (default: <code>letter</code>).</li>
<li><code>length</code>: Number of letters or words to turn into drop caps (default: 1).</li>
<li><code>coverage</code>: Array of book elements to process (default: [&#8216;chapter&#8217;]).   </li>
</ul>

<h3 id="description">Description</h3>

<p>There are several ways to add drop caps to the book:</p>

<ol>
<li>Automatic dropcaps.</li>
<li>Manual dropcaps HTML markup.</li>
<li>Markdown-like manual dropcaps. </li>
</ol>

<h4 id="automatic-drop-caps">Automatic drop caps</h4>

<p>Drop caps can be automatically added to the first paragraph after a heading. 
This behaviour can be influenced on a per-edition base setting options in 
the <code>plugins</code> configuration section inside the book&#8217;s <code>config.yml</code>.</p>

<div class="admonition note">
  <h5 id="note-2">Note</h5>
  
  <p>This book has automatic drop caps applied with the default options.</p>
</div>

<h4 id="manual-drop-caps-html-markup">Manual drop caps HTML markup</h4>

<p>HTML can be freely mixed into Markdown. So a way to manually add drop caps 
to the text is:</p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">span</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dropcaps&quot;</span>&gt;</span>T<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">span</span>&gt;</span>his is a paragraph that starts with a manually-added drop cap.</pre>
</div>

<p><strong>trefoil</strong> will produce the following HTML code that can be easily styled:</p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">p</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;has-dropcaps&quot;</span>&gt;&lt;<span class="kw2">span</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dropcaps&quot;</span>&gt;</span>T<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">span</span>&gt;</span>his is a paragraph that starts with a manually-added drop cap.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span></pre>
</div>

<h4 id="markdown-like-manual-drop-caps">Markdown-like manual drop caps</h4>

<p>Besides adding the HTML markup directly, a Markdown-like markup is provided for 
greater convenience.</p>

<div class="code markdown">
<pre class="markdown">[[T]]his text has first-letter drop caps.
&nbsp;
[[But]] this text has first-word drop caps.</pre>
</div>

<p>will produce the following HTML:</p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">p</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;has-dropcaps&quot;</span>&gt;&lt;<span class="kw2">span</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dropcaps&quot;</span>&gt;</span>T<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">span</span>&gt;</span>his text has first-letter drop caps.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">p</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;has-dropcaps&quot;</span>&gt;&lt;<span class="kw2">span</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dropcaps&quot;</span>&gt;</span>But<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">span</span>&gt;</span> this text has first-word drop caps.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span></pre>
</div>

<p>and will be shown in the book as (with some dummy text added):</p><p class="has-dropcaps"><span class="dropcaps">T</span>his text has first-letter drop caps. Lorem ipsum dolor sit amet, consetetur 
sadipscing elitr, sed diam nonumyeirmod tempor invidunt ut labore et dolore 
magna aliquyam erat, sed diamvoluptua.</p><p class="has-dropcaps"><span class="dropcaps">But</span> this text has first-word drop caps. Lorem ipsum dolor sit amet, consetetur 
sadipscing elitr, sed diam nonumyeirmod tempor invidunt ut labore et dolore magna 
aliquyam erat, sed diamvoluptua.</p>

<div class="page-break"></div>

<h2 id="footnotesextraplugin">FootnotesExtraPlugin</h2>

<p>This plugin processes footnotes generated by the Markdown parser and
transform them into endnotes (i.e. at the end of the book).</p>

<h3 id="availability-2">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-2">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> FootnotesExtra <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-2">Description</h3>

<p>The Markdown parser converts footnotes into hyperlinks, where the link target 
is the note text at the bottom of the document.</p>

<p>While this behavior<sup id="fnref-note1"><a href="#fn-note1" class="footnote-ref">1</a></sup> is adequate for printed books, ebooks are a different 
mattter. The &#8220;footnotes at the end of the chapter&#8221; approach does not work
well for electronic reading devices or applications because the notes stand 
in the way of the normal reading flow.</p>

<p>This plugin collects all footnotes markup generated by the Markdown parser
(at the end of each book element) and then generates a consolidated
footnotes list element with all the book&#8217;s footnotes.</p>

<div class="admonition note">
  <h5 id="tip">Tip</h5>
  
  <p>You can see an example of footnotes in this section (look at the source text).</p>
</div>

<div class="admonition note">
  <h5 id="todo">TODO</h5>
  
  <p>Create an adequate implementation for editions different from <code>epub</code> and <code>mobi</code> (like this one).</p>
</div>

<h3 id="output">Output</h3>

<p>The plugin will generate a report<sup id="fnref-note2"><a href="#fn-note2" class="footnote-ref">2</a></sup> in the output directory called <code>report-FootnotesPlugin.txt</code>
with a summary of terms processed and problems found.</p>

<div class="page-break"></div>

<h2 id="htmltweaksplugin">HtmlTweaksPlugin</h2>

<p>This plugin provides a way to tweak the book HTML after it has been generated.
It works modifying the HTML code produced by the Markdown processor or by the 
theme templates, so the final HTML code can meet specific requirements.</p>

<h3 id="availability-3">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-3">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> HTMLTweaks <span class="br0">&#93;</span></pre>
</div>

<p>The actual tweaks definitions are read from a separate <code>yaml</code> file:</p>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/Contents/html-tweaks.yml</span>
<span class="co1">#  or</span>
<span class="co1"># &lt;current-theme&gt;/Config/html-tweaks.yml</span><span class="co4">
tweaks</span><span class="sy2">:
</span>    <span class="co1"># replacements to be made at onPreParse time</span><span class="co3">
    onPreParse</span><span class="sy2">: </span>       <span class="co3">
        tweak-name-free</span><span class="sy2">: </span>                <span class="co1"># just a name</span><span class="co3">
            tag</span><span class="sy2">: </span>'tag name'              <span class="co1"># tag name to find</span><span class="co3">
            class</span><span class="sy2">: </span>'class-name'          <span class="co1"># OPTIONAL class name of tag</span>
&nbsp;
            <span class="co1"># either one of 'insert', 'surround' or 'replace' operations</span>
<span class="co3">
            insert</span><span class="sy2">: </span>   <span class="co1"># insert HTML code inside the tag (surround content)</span><span class="co3">
                open</span><span class="sy2">: </span> 'some html text'  <span class="co1"># opening text</span><span class="co3">
                close</span><span class="sy2">: </span>'more html text'  <span class="co1"># closing text</span>
<span class="co3">
            surround</span><span class="sy2">: </span> <span class="co1"># surround tag with HTML code (surround the tag)</span><span class="co3">
                open</span><span class="sy2">: </span> 'some html text'  <span class="co1"># opening text</span><span class="co3">
                close</span><span class="sy2">: </span>'more html text'  <span class="co1"># closing text</span>
<span class="co3">
            replace</span><span class="sy2">: </span>  <span class="co1"># replace tag with another one</span><span class="co3">
                tag</span><span class="sy2">: </span> 'another html tag' <span class="co1"># replacement tag</span>
&nbsp;
    <span class="co1"># replacements to be made at onPostParse time</span><span class="co3">
    onPostParse</span><span class="sy2">: </span>       <span class="co4">
        another-tweak-name</span>:<span class="co3">
            tag</span><span class="sy2">: </span>'tag name'
            <span class="co1"># same options than onPreParse</span>
            <span class="sy1">---</span>-</pre>
</div>

<h3 id="description-3">Description</h3>

<p>The Markdown processor generates fixed HTML structures for each Markdown tag 
that cannot be configured or parameterized. In occasisons could be desireable 
to customize the generated HTML to meet certain requierements.</p>

<p>Examples:</p>

<ul>
<li>Surround all <code>&lt;pre&gt;...&lt;/pre&gt;</code> tags with <code>&lt;div class="box"&gt;...&lt;/div&gt;</code>.</li>
<li>Append <code>&lt;hr&gt;</code> tag to each <code>&lt;h2&gt;</code> tag.</li>
</ul>

<p>Instead of having to write a dedicated plugin for that task, this plugin provides
the funcionality to resolve some simple cases.</p>

<div class="admonition note">
  <h5 id="note-3">Note</h5>
  
  <p>This plugin uses a separate configuration file <code>html-tweaks.yml</code> to provide the 
  tweaks&#8217; definitions. This file can be loaded from the theme in use or from the 
  book contents directory.</p>
</div>

<h4 id="the-configuration-file">The configuration file</h4>

<p>The tweaks&#8217; definitions are read from file <code>html-tweaks.yml</code>, that can be located:</p>

<ul>
<li>In the book <code>/Contents</code> directory</li>
<li>In the theme <code>/Config/&lt;format&gt;</code> directory</li>
</ul>

<p>The first one found will be used. This allows distributing the tweaks as part of the
theme, or customizing them for an specific book.</p>

<p>The <code>onPreParse</code> tweaks will be made before the Markdown parser has processed the item
(so they can easyly pick any raw HTML embedded into the Markdown text), while the <code>onPostParse</code>
tweaks will work on the HTML produced by the Markdown processor.</p>

<h4 id="example">Example</h4>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/Contents/html-tweaks.yml</span>
<span class="co1">#  or</span>
<span class="co1"># &lt;current-theme&gt;/Config/html-tweaks.yml</span><span class="co4">
tweaks</span><span class="sy2">:
</span><span class="co4">
    onPreParse</span><span class="sy2">:
</span>        <span class="co1"># enclose contents of all divs of class &quot;one&quot; with box1</span><span class="co3">
        tweak-div-one</span><span class="sy2">: </span>                                <span class="co3">
            tag</span><span class="sy2">: </span>'div'<span class="co3">
            class</span><span class="sy2">: </span>'one'   <span class="co4">
            insert</span>:<span class="co3">
                open</span><span class="sy2">: </span> '&lt;div class=<span class="st0">&quot;box1&quot;</span> markdown=<span class="st0">&quot;1&quot;</span>&gt;'<span class="co3">
                close</span><span class="sy2">: </span>'&lt;/div&gt;'
&nbsp;
        <span class="co1"># surround all divs of class &quot;two&quot; with box2</span><span class="co3">
        tweak-div-two</span><span class="sy2">: </span>                                <span class="co3">
            tag</span><span class="sy2">: </span>'div'<span class="co3">
            class</span><span class="sy2">: </span>'two'   <span class="co3">
            surround</span><span class="sy2">: </span><span class="co3">
                open</span><span class="sy2">: </span> '&lt;div class=<span class="st0">&quot;box2&quot;</span>&gt;'<span class="co3">
                close</span><span class="sy2">: </span>'&lt;/div&gt;'
&nbsp;
        <span class="co1"># replace all spans with divs</span><span class="co3">
        tweak-span-three</span><span class="sy2">: </span><span class="co3">
            tag</span><span class="sy2">: </span>'span'<span class="co3">
            replace</span><span class="sy2">: </span><span class="co3">
                tag</span><span class="sy2">: </span> 'div'                  
                    <span class="co4">
    onPostParse</span><span class="sy2">:
</span>        <span class="co1"># enclose contents of 'pre' tags between lines</span><span class="co3">
        tweak-pre</span><span class="sy2">: </span>                                <span class="co3">
            tag</span><span class="sy2">: </span>'pre'   <span class="co4">
            insert</span>:<span class="co3">
                open</span><span class="sy2">: </span> '======\n'<span class="co3">
                close</span><span class="sy2">: </span>'\n<span class="sy1">------</span>'
&nbsp;
        <span class="co1"># surround tables with box1</span><span class="co4">
        tweak-table</span>:<span class="co3">
            tag</span><span class="sy2">: </span>'table'<span class="co3">
            surround</span><span class="sy2">: </span><span class="co3">
                open</span><span class="sy2">: </span> '&lt;div class=<span class="st0">&quot;box1&quot;</span>&gt;'<span class="co3">
                close</span><span class="sy2">: </span>'&lt;/div&gt;'
&nbsp;
        <span class="co1"># convert all unordered lists into ordered lists</span><span class="co4">
        tweak-ul</span>:<span class="co3">
            tag</span><span class="sy2">: </span>'ul'<span class="co3">
            replace</span><span class="sy2">: </span><span class="co3">
                tag</span><span class="sy2">: </span> 'ol'</pre>
</div>

<div class="page-break"></div>

<h2 id="imageextraplugin">ImageExtraPlugin</h2>

<p>This plugin provides an extended image syntax to allow more precise styling of images.</p>

<h3 id="availability-4">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-4">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> ImageExtra <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-4">Description</h3>

<p>Features:</p>

<ul>
<li>Explicit image path.</li>
<li>Extended image syntax.</li>
<li>Extended styles in themes.</li>
</ul>

<h4 id="explicit-image-path">Explicit image path</h4>

<p>Some Markdown editors provide a live preview of the rendered HTML result. Some of them even
provide live preview for images (like the fabulous <a href="http://www.mdcharm.com/">MdCharm</a>), but 
for this to work the image path must point to the relative location of the image:</p>

<div class="code markdown">
<pre class="markdown"># This is the easybook way, 
# but the preview won't work:
![This is image 1](image1.jpeg)
&nbsp;
# You can write it this way,
# an the preview will work:
![This is image 1](images/image1.jpeg)</pre>
</div>

<p>Both ways will render exactly the same, but only the second one will produce a preview in
editors like <em>MdCharm</em>.</p>

<h4 id="extended-image-syntax">Extended image syntax</h4>

<p><strong>trefoil</strong> extends the Markdown syntax for images providing a <code>class</code> and <code>style</code> arguments
with similar syntax than the HTML counterparts.</p>

<ul>
<li><strong>class:</strong> You can provide one or several classes to be applied to the image markup.</li>
<li><strong>style:</strong> You can even apply any CSS style specification.</li>
</ul>

<div class="admonition note">
  <h5 id="tip-2">Tip</h5>
  
  <p>The included <strong>trefoil</strong> templates are ready to make use the extended markup.
  The standard <strong>easybook</strong> templates, on the other hand, are not.</p>
</div>

<div class="code markdown">
<pre class="markdown">![caption](image.name?class=&quot;myclass&quot;&amp;style=&quot;any_css_style_specification&quot;)</pre>
</div>

<p>Example:</p>

<div class="code markdown">
<pre class="markdown">![Lorem ipsum](php.jpg?class=&quot;half my-class&quot;&amp;style=&quot;background: #cde; padding-right: 2em;&quot;)</pre>
</div>

<div class="admonition note">
  <h5 id="note-4">Note</h5>
  
  <p>Standard <strong>easybook</strong> image alignment syntax still works:</p>
  
  <p><code>![ Left aligned](php.jpg?class="narrower")</code></p>
</div>

<h4 id="extended-styles-in-themes">Extended styles in themes</h4>

<p><strong>trefoil</strong> themes come with some predefined image classes:</p>

<ul>
<li><strong>narrower:</strong> 1/4 of the page width (up to 4 images side by side).   </li>
<li><strong>narrow:</strong> 1/3 of the page width (up to 3 images side by side).</li>
<li><strong>half:</strong> 1/2 of the page width (up to 2 images side by side).</li>
<li><strong>wide:</strong> full page width.   </li>
</ul>

<h4 id="examples">Examples</h4>

<h5 id="narrower-right">Narrower right</h5>

<div class="figure right narrower" id="figure-3-1">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrower" />

    <p class="caption"><strong>Figure 3.1</strong> Lorem ipsum</p>
</div>
</div>


<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sit amet velit a libero 
congue molestie. Integer ipsum massa, posuere nec massa eu, dapibus volutpat justo. 
Nullam enim dolor, scelerisque non dui et, ornare ultricies enim. Mauris sed felis sem. 
Praesent aliquam quam nec diam mollis ultrices. Nunc mattis pretium tellus, et luctus 
augue commodo sed. Interdum et malesuada fames ac ante ipsum primis in faucibus. 
Ut orci tortor, malesuada ac mauris sit amet, ornare sollicitudin massa.</p>

<div class="clearfix"></div>

<h5 id="narrower-4-in-a-row">Narrower 4 in a row</h5>

<div class="figure narrower" id="figure-3-2">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrower" />

    <p class="caption"><strong>Figure 3.2</strong> Lorem ipsum</p>
</div>
</div>

<div class="figure narrower" id="figure-3-3">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrower" />

    <p class="caption"><strong>Figure 3.3</strong> Lorem ipsum</p>
</div>
</div>

<div class="figure narrower" id="figure-3-4">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrower" />

    <p class="caption"><strong>Figure 3.4</strong> Lorem ipsum</p>
</div>
</div>

<div class="figure narrower" id="figure-3-5">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrower" />

    <p class="caption"><strong>Figure 3.5</strong> Lorem ipsum</p>
</div>
</div>


<div class="clearfix"></div>

<h5 id="narrower-centered">Narrower centered</h5>

<div class="figure center narrower" id="figure-3-6">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrower" />

    <p class="caption"><strong>Figure 3.6</strong> Lorem ipsum</p>
</div>
</div>


<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sit amet velit a libero congue molestie. Integer ipsum massa, posuere nec massa eu, dapibus volutpat justo. Nullam enim dolor, scelerisque non dui et, ornare ultricies enim. Mauris sed felis sem. Praesent aliquam quam nec diam mollis ultrices. Nunc mattis pretium tellus, et luctus augue commodo sed. Interdum et malesuada fames ac ante ipsum primis in faucibus. Ut orci tortor, malesuada ac mauris sit amet, ornare sollicitudin massa.</p>

<div class="clearfix"></div>

<h5 id="narrow-right">Narrow right</h5>

<div class="figure right narrow" id="figure-3-7">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrow" />

    <p class="caption"><strong>Figure 3.7</strong> Lorem ipsum</p>
</div>
</div>


<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sit amet velit a libero congue molestie. Integer ipsum massa, posuere nec massa eu, dapibus volutpat justo. Nullam enim dolor, scelerisque non dui et, ornare ultricies enim. Mauris sed felis sem. Praesent aliquam quam nec diam mollis ultrices. Nunc mattis pretium tellus, et luctus augue commodo sed. Interdum et malesuada fames ac ante ipsum primis in faucibus. Ut orci tortor, malesuada ac mauris sit amet, ornare sollicitudin massa.</p>

<div class="clearfix"></div>

<h5 id="narrow-3-in-a-row">Narrow 3 in a row</h5>

<div class="figure narrow" id="figure-3-8">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrow" />

    <p class="caption"><strong>Figure 3.8</strong> Lorem ipsum</p>
</div>
</div>
 
<div class="figure narrow" id="figure-3-9">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrow" />

    <p class="caption"><strong>Figure 3.9</strong> Lorem ipsum</p>
</div>
</div>

<div class="figure narrow" id="figure-3-10">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrow" />

    <p class="caption"><strong>Figure 3.10</strong> Lorem ipsum</p>
</div>
</div>


<div class="clearfix"></div>

<h5 id="narrow-centered">Narrow centered</h5>

<div class="figure center narrow" id="figure-3-11">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="narrow" />

    <p class="caption"><strong>Figure 3.11</strong> Lorem ipsum</p>
</div>
</div>


<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sit amet velit a libero congue molestie. Integer ipsum massa, posuere nec massa eu, dapibus volutpat justo. Nullam enim dolor, scelerisque non dui et, ornare ultricies enim. Mauris sed felis sem. Praesent aliquam quam nec diam mollis ultrices. Nunc mattis pretium tellus, et luctus augue commodo sed. Interdum et malesuada fames ac ante ipsum primis in faucibus. Ut orci tortor, malesuada ac mauris sit amet, ornare sollicitudin massa.</p>

<div class="clearfix"></div>

<h5 id="half-left">Half left</h5>

<div class="figure left half" id="figure-3-12">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="half" />

    <p class="caption"><strong>Figure 3.12</strong> Lorem ipsum</p>
</div>
</div>


<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sit amet velit a libero congue molestie. Integer ipsum massa, posuere nec massa eu, dapibus volutpat justo. Nullam enim dolor, scelerisque non dui et, ornare ultricies enim. Mauris sed felis sem. Praesent aliquam quam nec diam mollis ultrices. Nunc mattis pretium tellus, et luctus augue commodo sed. Interdum et malesuada fames ac ante ipsum primis in faucibus. Ut orci tortor, malesuada ac mauris sit amet, ornare sollicitudin massa.</p>

<div class="clearfix"></div>

<h5 id="half-2-in-a-row">Half 2 in a row</h5>

<div class="figure half" id="figure-3-13">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="half" />

    <p class="caption"><strong>Figure 3.13</strong> Lorem ipsum</p>
</div>
</div>

<div class="figure half" id="figure-3-14">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="half" />

    <p class="caption"><strong>Figure 3.14</strong> Lorem ipsum</p>
</div>
</div>


<div class="clearfix"></div>

<h5 id="half-centered">Half centered</h5>

<div class="figure center half" id="figure-3-15">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="half" />

    <p class="caption"><strong>Figure 3.15</strong> Lorem ipsum</p>
</div>
</div>


<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sit amet velit a libero congue molestie. Integer ipsum massa, posuere nec massa eu, dapibus volutpat justo. Nullam enim dolor, scelerisque non dui et, ornare ultricies enim. Mauris sed felis sem. Praesent aliquam quam nec diam mollis ultrices. Nunc mattis pretium tellus, et luctus augue commodo sed. Interdum et malesuada fames ac ante ipsum primis in faucibus. Ut orci tortor, malesuada ac mauris sit amet, ornare sollicitudin massa.</p>

<div class="clearfix"></div>

<h5 id="wide">Wide</h5>

<div class="figure wide" id="figure-3-16">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="wide" />

    <p class="caption"><strong>Figure 3.16</strong> Lorem ipsum</p>
</div>
</div>


<div class="clearfix"></div>

<h5 id="class-and-style">Class and style</h5>

<div class="figure half my-class" id="figure-3-17">
<div class="box">
    <img src="images/php.jpg" alt="Lorem ipsum" class="half my-class" style="background: #cde; padding-right: 2em;" />

    <p class="caption"><strong>Figure 3.17</strong> Lorem ipsum</p>
</div>
</div>


<div class="clearfix"></div>

<div class="page-break"></div>

<h2 id="kindletweaksplugin">KindleTweaksPlugin</h2>

<p>This plugin provides several tweaks to make the ebook more compatible with 
Kindle MOBI format.</p>

<p>This is only needed for the <em>old</em> MOBI format, not the  <em>new</em> KF8 format, 
so if you are not targeting old Kindle devices you may not need this plugin.</p>

<h3 id="availability-5">Availability</h3>

<p>This plugin is available for <code>Epub</code> and <code>Mobi</code> editions.</p>

<div class="admonition note">
  <h5 id="note-5">Note</h5>
  
  <p>The provided tweaks are specificaly targeted to Kindle readers, but could also
  be useful for some EPUB reader devices or applications. That is the reason why 
  the plugin is available also for <code>Epub</code> editions.</p>
</div>

<h3 id="usage-5">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> KindleTweaks <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-5">Description</h3>

<p>The plugin provides the following tweaks:</p>

<ul>
<li>Convert paragraphs inside list elements to line breaks.</li>
<li>Explicit table cell alignment.</li>
</ul>

<h4 id="convert-paragraphs-inside-lists">Convert paragraphs inside lists</h4>

<p>The Markdown processor allows two kinds of markup to generate a list:</p>

<div class="code markdown">
<pre class="markdown">A list without blank lines between elements:
&nbsp;
- One.
- Two.
- Three.
&nbsp;
The same list but element &quot;Two&quot; has a second line:
&nbsp;
- One.
- Two.
&nbsp;
  This is second line of &quot;Two&quot; element.
&nbsp;
- Three.</pre>
</div>

<p>The generated HTML will look like:</p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">p</span>&gt;</span>A list without blank lines between elements:<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">ul</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>One.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>Two.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>Three.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">ul</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">p</span>&gt;</span>The same list but element &quot;Two&quot; has a second line:<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">ul</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>One.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;&lt;<span class="kw2">p</span>&gt;</span>Two.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">p</span>&gt;</span>This is second line of &quot;Two&quot; element.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;&lt;<span class="kw2">p</span>&gt;</span>Three.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">ul</span>&gt;</span></pre>
</div>

<p>In the second list, elements &#8220;One&#8221; and &#8220;Three&#8221; are still rendered &#8220;as is&#8221;, 
but element &#8220;Two&#8221; has paragraph tags enclosing each &#8220;paragraph&#8221;. 
This could cause rendering issues with older Kindles, making element &#8220;Two&#8221;
look different than elements &#8220;One&#8221; and &#8220;Three&#8221;.</p>

<p>When this plugin is activated all elements will be rendered without the extra
paragraph tags, and all internal paragraph tags will be replaced by a 
line break tag:</p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">p</span>&gt;</span>The same list but element &quot;Two&quot; has a second line:<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">ul</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>One.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>Two.<span class="sc2">&lt;<span class="kw2">br</span><span class="sy0">/</span>&gt;</span>
&nbsp;
This is second line of &quot;Two&quot; element.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">li</span>&gt;</span>Three.<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">li</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">ul</span>&gt;</span></pre>
</div>

<h4 id="explicit-table-cell-alignment">Explicit table cell alignment</h4>

<p>Table cell alignment assigned via CSS classes doesn&#8217;t work in older Kindles. 
This plugin will assign explicit alignment via HTML attributes to the table
cells.</p>

<div class="page-break"></div>

<h2 id="tableextraplugin">TableExtraPlugin</h2>

<p>This plugin provides extra functionality to Markdown tables, adding the 
ability to &#8220;colspan&#8221; or &#8220;rowspan&#8221; cells.</p>

<h3 id="availability-6">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-6">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> TableExtra <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-6">Description</h3>

<p>Markdown syntax for tables is pretty limited:</p>

<div class="code code">
<pre class="code">Column 1  | Column 2  | Column 3
----------|-----------|------------
1.One     | 1.Two     | 1.Three
2.One     | 2.Two     | 2.Three</pre>
</div>

<p>will render as:</p>

<div class="table" id="table-3-1">

    <table><thead><tr><th   >Column 1</th><th   >Column 2</th><th   >Column 3</th></tr></thead><tbody><tr><td   >1.One</td><td   >1.Two</td><td   >1.Three</td></tr><tr><td   >2.One</td><td   >2.Two</td><td   >2.Three</td></tr></tbody></table>
</div>


<h4 id="adding-rowspanned-cells">Adding rowspanned cells</h4>

<p>A cell containig only <code>"</code> (a double quote) will be joined with the 
above cell in the previous row:</p>

<div class="code code">
<pre class="code">Column 1  | Column 2  | Column 3
----------|-----------|------------
1.One     | 1.Two     | 1.Three
  &quot;       | 2.Two     | 2.Three</pre>
</div>

<p>This will render as:</p>

<div class="table" id="table-3-2">

    <table><thead><tr><th   >Column 1</th><th   >Column 2</th><th   >Column 3</th></tr></thead><tbody><tr><td rowspan="2"  style="vertical-align: middle;" >1.One</td><td   >1.Two</td><td   >1.Three</td></tr><tr><td   >2.Two</td><td   >2.Three</td></tr></tbody></table>
</div>


<h4 id="adding-colpanned-cells">Adding colpanned cells</h4>

<p>An empty cell will be joined whith the preceding cell in the same row:</p>

<div class="code code">
<pre class="code">Column 1  | Column 2  | Column 3
----------|-----------|------------
1.One                || 1.Three
2.One     | 2.Two     | 2.Three</pre>
</div>

<p>This will render as:</p>

<div class="table" id="table-3-3">

    <table><thead><tr><th   >Column 1</th><th   >Column 2</th><th   >Column 3</th></tr></thead><tbody><tr><td  colspan="2" >1.One</td><td   >1.Three</td></tr><tr><td   >2.One</td><td   >2.Two</td><td   >2.Three</td></tr></tbody></table>
</div>


<div class="admonition tip">
  <h5 id="tip-3">Tip</h5>
  
  <p>To avoid a blank cell to be interpreted as colspanned, enter <code>&amp;nbsp;</code></p>
</div>

<p>as its contents, as in the following example.</p>

<div class="table" id="table-3-4">

    <table><thead><tr><th   >Column 1</th><th   >Column 2</th><th   >Column 3</th></tr></thead><tbody><tr><td   >1.One</td><td   >&nbsp;</td><td   >1.Three</td></tr><tr><td   >2.One</td><td   >2.Two</td><td   >2.Three</td></tr></tbody></table>
</div>


<h4 id="a-more-complex-example">A more complex example</h4>

<p>The following example mixes rowspanned and colspanned cells and makes use 
of table column alignment syntax:</p>

<div class="code code">
<pre class="code">Column 1  | Column 2  | Column 3
---------:|:----------|:----------:
1.One                || 1.Three
&quot;                    || 2.Three
3.One     | 3.Two     | 3.Three
4.One     | 4.Two     | 4.Three</pre>
</div>

<p>The rendered result will be:</p>

<div class="table" id="table-3-5">

    <table><thead><tr><th   align="right" >Column 1</th><th   align="left" >Column 2</th><th   align="center" >Column 3</th></tr></thead><tbody><tr><td rowspan="2" colspan="2" align="right" style="vertical-align: middle;" >1.One</td><td   align="center" >1.Three</td></tr><tr><td   align="center" >2.Three</td></tr><tr><td   align="right" >3.One</td><td   align="left" >3.Two</td><td   align="center" >3.Three</td></tr><tr><td   align="right" >4.One</td><td   align="left" >4.Two</td><td   align="center" >4.Three</td></tr></tbody></table>
</div>


<div class="page-break"></div>

<h2 id="typographyplugin">TypographyPlugin</h2>

<p>This plugin replaces certain symbols with its typographic equivalents. 
It makes use of the <code>SmartyPants</code> library: <a href="http://daringfireball.net/projects/smartypants/">http://daringfireball.net/projects/smartypants/</a></p>

<h3 id="availability-7">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-7">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> TypographyPlugin <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co4">
                    Typography</span>:<span class="co3">
                        checkboxes</span><span class="sy2">: </span>true<span class="co3">
                        fix_spanish_style_dialog</span><span class="sy2">: </span>false</pre>
</div>

<h3 id="description-7">Description</h3>

<p>The following symbols are replaced with its typographic equivalents whenever appropriate:</p>

<ul>
<li>Double quotes (<code>".."</code>) and <em>backtick</em> quotes (<code>``</code>..<code>''</code>) are converted to typograhic double quotes (&#8220;..&#8221;).</li>
<li>Three dots (<code>...</code>) are converted to the ellipsis typographic symbol (&#8230;).</li>
<li>Two dashes (<code>--</code>) are converted to em-dash (&#8212;).</li>
<li>Two less-than or greater-than symbols (<code>&lt;&lt;</code> and <code>&gt;&gt;</code>) are converted to angle quotes (&#171;..&#187;).</li>
</ul>

<p>Option <code>checkboxes</code> allows writing a checkbox-like sign, both unchecked and checked.</p>

<ul>
<li>Checkboxes can be writen as &#91; &#93; and &#91;/&#93; and will be converted to &#9744; and &#9745;.</li>
</ul>

<p>Option <code>fix_spanish_style_dialog</code> fixes the usage of dash (&#8216;-&#8216;) instead of em-dash (&#8216;&#8212;&#8217;) for dialog 
transcription in Spanish.</p>

<div class="admonition note">
  <h5 id="note-6">Note</h5>
  
  <p>The correct way of writing dialogs between characters in Spanish books is using the em-dash symbol 
  (&#8220;&#8221;, called &#8220;raya&#8221; in Spanish) instead of using quotes like the English written dialogs. 
  That is only the more obvious difference, but there are several other typographic conventions and
  rules that must be followed when writing dialogs in Spanish books.</p>
</div>

<h4 id="example-of-spanish-style-written-dialog">Example of Spanish-style written dialog</h4>

<p>The following example is extracted from &#8220;<em>The Adventures of Sherlock Holmes: A scandal in Bohemia</em>&#8221;:</p>

<p><strong>Original dialog in English:</strong></p>

<blockquote>
  <p>Wedlock suits you, he remarked. I think, Watson, that you have put on seven and a half
  pounds since I saw you.</p>
  
  <p>Seven! I answered.</p>
</blockquote>

<p><strong>Spanish translation:</strong></p>

<blockquote>
  <p>&#8212;El matrimonio le sienta bien &#8212;coment&#8212;. Yo dira, Watson, que ha engordado
  usted siete libras y media desde la ltima vez que le vi.</p>
  
  <p>&#8212;Siete &#8212;respond.</p>
</blockquote>

<div class="page-break"></div>

<h2 id="twigextensionplugin">TwigExtensionPlugin</h2>

<p>This plugin extends Twig to provide some useful functionalities:</p>

<h3 id="availability-8">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-8">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> TwigExtension <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co3">
                    TwigExtension</span><span class="sy2">: </span><span class="co4">
                        itemtoc</span>:<span class="co3">
                            deep</span><span class="sy2">: </span><span class="nu0">2</span>  <span class="co1"># defaults to &lt;edition&gt;.toc.deep + 1</span></pre>
</div>

<h3 id="description-8">Description</h3>

<p>The funcionalities provided are:</p>

<ul>
<li>Twig in content.</li>
<li>Configuration options in content.</li>
<li>Local TOC (table of contents).</li>
<li>Include files into content.</li>
</ul>

<h4 id="twig-in-content">Twig in content</h4>

<p><strong>trefoil</strong> adds the ability to write Twig code in content:</p>

<div class="code"><pre>
&#123;# this is a Twig comment inside a content item #&#125;
**Lorem ipsum** dolor sit amen. 

&#123;% if 1 == 2 %&#125; 
**Awesome,** it seems that 1 equals 2!!!
&#123;% else %&#125;
No, definitely 1 does not equal 2.
&#123;% endif %&#125;
</pre></div>

<p>The above piece of text will render as:</p>

<blockquote>
  <p><strong>Lorem ipsum</strong> dolor sit amen.</p>
  
  <p>No, definitely 1 does not equal 2.</p>
</blockquote>

<p>But why in the world would you want to mix Twig code or functions with 
your content? 
Some complex pieces of content could benefit from having some logic
applied (example: using some book configuration option value to hide or 
show some section). And the ability to mix Twig comments in the text is
definitely a good thing (example: to write some TODO note so you remember
to change some part of the text in a future revision).</p>

<h4 id="configuration-options-in-content">Configuration options in content</h4>

<p><strong>easybook</strong> only allows configuration options in templates but not in content.
But thanks to the &#8220;Twig in content&#8221; functonality now you can do it:</p>

<div class="code"><pre>
**This will not work without this plugin:**

> The title of this book is "*&#123;&#123; book.title &#125;&#125;*".
</pre></div>

<p>This plugin provides such functionality, allowing the use of any configuration option 
in the content.</p>

<p>With this plugin activated, it works:</p>

<blockquote>
  <p>The title of this book is &#8220;<em>Trefoil documentation</em>&#8221;.</p>
</blockquote>

<h4 id="local-toc">Local TOC</h4>

<p>Large ebooks with lots of sections and subsections could benefit from having a table of contents
at the begining of each chapter (think of a text book, where each lesson is a book chapter).</p>

<p>This plugin provides a Twig function <code>itemtoc()</code> that can be inserted anywhere in the item content 
(thanks to the &#8220;configuration options in content&#8221; functionality).</p>

<p>It uses de <code>itemtoc.twig</code> template that must be available either as a local or global template.</p>

<p>Usage:</p>

<div class="code"><pre>
&#123;&#123; itemtoc() &#125;&#125;
</pre></div>

<div class="admonition note">
  <h5 id="note-7">Note</h5>
  
  <p>You can see an example at the begining of each chapter of the <code>epub</code> or <code>kindle</code> editions 
  of this book.</p>
</div>

<h4 id="include-files-into-content">Include files into content</h4>

<p>Sometimes it could be useful to divide a large chapter into smaller pieces, and then including
all the pieces into the chapter&#8217;s content.</p>

<p>This plugin provides a <code>file()</code> Twig function that works pretty much like PHP&#8217;s <code>include()</code>function, 
allowing the inclusion of another file.</p>

<p>Usage:</p>

<div class="code"><pre>
&#123;&#123; file(filename, variables, options) &#125;&#125;
</pre></div>

<p>where &#8220;variables&#8221; and &#8220;options&#8221; are optional hash tables where you can pass variables to the 
included file as in <code>{'variable': 'value'}</code>, or options that affect the rendering.</p>

<p>The available options are:</p>

<ul>
<li><code>{'nopagebreak': false}</code>: do not insert a page break after the included file (<code>true</code> by default)</li>
</ul>

<div class="admonition note">
  <h5 id="note-8">Note</h5>
  
  <p>You can see an example in the source text of this chapter. Pagebreaks will only work on <code>Kindle</code>
  readers and certain <code>epub</code> readers.</p>
</div>

<div class="page-break"></div>



</div>
                            <div class="item chapter">
    <h1 id="the-trefoil-utility-plugins"><span>Chapter 4</span> The Trefoil utility plugins</h1>
    <p class="has-dropcaps"><span class="dropcaps">T</span>his chapter describes the <em>utility plugins</em>. These plugins
provide functionalities that, while not related to the book&#8217;s
appearance, bring useful and convenient enhancements to the
publication workflow.</p>


    <div class="btn-group visible-xs visible-sm">

                
        <button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
            In this chapter:
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#ebookrenameplugin">
                            EbookRenamePlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#epubcheckplugin">
                            EpubCheckPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#epubuncompressplugin">
                            EpubUncompressPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#linkcheckplugin">
                            LinkCheckPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#qualitycontrolplugin">
                            QualityControlPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#versionupdaterplugin">
                            VersionUpdaterPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                </ul>
    </div>


<h2 id="ebookrenameplugin">EbookRenamePlugin</h2>

<p>This plugin copies the generated file <code>book.&lt;ext&gt;</code> to <code>&lt;new-name&gt;.&lt;ext&gt;</code>. 
The original <code>book.&lt;ext&gt;</code> file can be optionally kept.</p>

<h3 id="availability-9">Availability</h3>

<p>This plugin is available for <code>epub</code> and <code>mobi</code> editions.</p>

<h3 id="usage-9">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> EbookRename <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co4">
                    EbookRename</span>:<span class="co3">
                        schema</span><span class="sy2">: </span> '<span class="br0">&#123;</span>publishing.book.slug<span class="br0">&#125;</span>-<span class="br0">&#123;</span>book.version<span class="br0">&#125;</span>' <span class="co3">
                        keep_original</span><span class="sy2">: </span> true</pre>
</div>

<h3 id="description-9">Description</h3>

<p>The naming schema is derived from Twig syntax but with single curly brackets.</p>

<p>Allowed variables are:</p>

<ul>
<li><code>publishing.book.slug</code> (the book slug).</li>
<li>any <code>book</code> or <code>edition</code> config variable.</li>
</ul>

<div class="page-break"></div>

<h2 id="epubcheckplugin">EpubCheckPlugin</h2>

<p>This plugin checks the generated epub ebook using the <code>EpubCheck</code> utility.
See <a href="https://github.com/IDPF/epubcheck">https://github.com/IDPF/epubcheck</a> for download options and more
information.</p>

<h3 id="availability-10">Availability</h3>

<p>This plugin is available for <code>epub</code> editions.</p>

<h3 id="usage-10">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
easybook</span>:<span class="co4">
    parameters</span><span class="sy2">:
</span>        <span class="sy1">...</span><span class="co3">
        epubcheck.path</span><span class="sy2">: </span>'/path/to/epubcheck.jar'<span class="co3">
        epubcheck.command_options</span><span class="sy2">: </span>''
<span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> EpubCheck <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-10">Description</h3>

<p><code>EpubCheck</code> is a tool to validate <code>epub</code> files (version 2.0 and later).</p>

<p>To use it, download the relevant <code>.jar</code> file to some directory on your computer
and configure that path in the <code>epubcheck.path</code> option of <code>config.yml</code> as shown above.
You can also pass some options via the <code>epubcheck.command_options</code> option.</p>

<h3 id="output-2">Output</h3>

<p>The plugin will generate a report in the output directory called <code>report-EpubCheckPlugin.txt</code>.</p>

<div class="page-break"></div>

<h2 id="epubuncompressplugin">EpubUncompressPlugin</h2>

<p>This plugin uncompresses the geneated <code>book.epub</code> file to make it easy looking 
at its contents.</p>

<p>This can be useful when debugging templates, to make it sure the final HTML 
inside the EPUB file is correct.</p>

<h3 id="availability-11">Availability</h3>

<p>This plugin is available for <code>epub</code> editions.</p>

<h3 id="usage-11">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> EpubUncompress <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-11">Description</h3>

<p>The uncompressed contents are left into the same directory where the <code>book.epub</code> 
file is generated.</p>

<div class="page-break"></div>

<h2 id="linkcheckplugin">LinkCheckPlugin</h2>

<p>This plugin checks all the internal and external links in the book.</p>

<h3 id="availability-12">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-12">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> LinkCheckPlugin <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co4">
                    LinkCheck</span>:<span class="co3">
                        check_external_links</span><span class="sy2">: </span>true</pre>
</div>

<h3 id="description-12">Description</h3>

<p><strong>Internal links</strong> are checked by looking for a valid link target, i.e. an html element
whith id=&#8221;the-link-target&#8221; in the whole book. This is useful for manually inserted links
or anchors in the text (remember that you can freely insert pure HTML into Markdown).</p>

<p>This is valid:</p>

<div class="code markdown">
<pre class="markdown">#### My section {anchor-to-my-section}
&nbsp;
I can link to [my section](#anchor-to-my-section).
&nbsp;
&lt;div id=&quot;other-anchor&quot;&gt;&lt;/div&gt;
&nbsp;
Lorem ipsum...
&nbsp;
And also can link to [other anchor](#other-anchor)</pre>
</div>

<p><strong>External links</strong> are (optionally) checked for existence by performing a network lookup.
This behaviour is off by default because could be very time consuming if the book
has a large number of external links. To turn it on, set the following option in
the book&#8217;s `config.yml&#8217; .</p>

<h3 id="output-3">Output</h3>

<p>The plugin will generate a report in the output directory called <code>report-LinkCheckPlugin.txt</code>.</p>

<div class="page-break"></div>

<h2 id="qualitycontrolplugin">QualityControlPlugin</h2>

<p>This plugin checks the book for common problems or mistakes.</p>

<h3 id="availability-13">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-13">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> QualityControl <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-13">Description</h3>

<p>The checks performed are:</p>

<ul>
<li><p><strong>Unused images:</strong> Any unused image in the final book can cause problems, like adding extra
size to the generated file or even failing a validation (like the <code>EpubCheck</code> utility for
<code>epub</code> editions).</p></li>
<li><p><strong>Emphasis marks not processed:</strong> The Markdown makes and excelent work but sometimes it can
get confused with some edge cases, leaving emphasis marks slip unprocessed into the final
book text.</p></li>
</ul>

<p>Consider the following example, where the writer intended to add bold emphasis to word &#8220;dolor&#8221;
but left an extra espace after the word inside the closing &#8220;&#42;&#42;&#8221; (word &#8220;sadipscing&#8221;, on the
other hand, is correctly emphasized):</p>

<div class="code markdown">
<pre class="markdown">Lorem ipsum **dolor ** sit amet, consetetur **sadipscing** elitr.</pre>
</div>

<p>This will be rendered as:</p>

<blockquote>
  <p>Lorem ipsum <strong>dolor ** sit amet, consetetur **sadipscing</strong> elitr</p>
</blockquote>

<p>Instead of the intended:</p>

<blockquote>
  <p>Lorem ipsum <strong>dolor</strong> sit amet, consetetur <strong>sadipscing</strong> elitr</p>
</blockquote>

<p>The plugin will report the problem so it can be easily spotted and fixed.</p>

<h3 id="output-4">Output</h3>

<p>The plugin will generate a report in the output directory called <code>report-QualityCheckPlugin.txt</code>.</p>

<div class="page-break"></div>

<h2 id="versionupdaterplugin">VersionUpdaterPlugin</h2>

<p>This plugin updates an optional version string from <code>config.yml</code>.</p>

<p>The format of the version string must be <code>"&lt;version&gt;.&lt;revision&gt;"</code>, 
where each component is an integer and the separator is a single dot.</p>

<h3 id="availability-14">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-14">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span><span class="co3">
    version</span><span class="sy2">: </span>'<span class="nu0">1.0</span>'  <span class="co1"># This is the version string</span>
&nbsp;
    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> VersionUpdater <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co4">
                    VersionUpdater</span>:<span class="co3">
                        increment_ver</span><span class="sy2">: </span>false <span class="co1"># don't increment the version (default)</span><span class="co3">
                        increment_rev</span><span class="sy2">: </span>true  <span class="co1"># increment the revision (default)</span></pre>
</div>

<h3 id="description-14">Description</h3>

<p>Having a version string in <code>book.yml</code> is useful because it can be used in 
the templates (for example in <code>title.twig</code>) to make it easy to distinguish 
between two different versions of the book. Also, if you have the 
<code>TwigExtensionPlugin</code> enabled, you can also use its contents in any content 
element.</p>

<p>This plugin performs an automatic update of the version string in <code>config.yml</code>
so you don&#8217;t have to remember incrementing the revision after each time the 
book is generated.</p>

<div class="admonition note">
  <h5 id="note-9">Note</h5>
  
  <p>The version is updated <strong>after</strong> the book is generated. This way is easy 
  to know the value of the next version of the book just looking into <code>config.yml</code>.</p>
</div>

<p>The arguments allow selectively incrementing any of the components.</p>

<p>When the <code>version</code> component is incremented, the <code>revision</code> component is reset to 0.</p>

<div class="admonition tip">
  <h5 id="tip-4">Tip</h5>
  
  <p>You could set a normal <code>ebook</code> edition that only increments the <code>revision</code> 
  component each time you produce a new &#8220;work in progress&#8221; ebook, and another 
  separate edition <code>ebook-ok</code> to increment the <code>version</code> part each time you want 
  to generate a &#8220;ready to publish&#8221; ebook. 
  Taking advantage of the editions inheritance make it even more convenient.</p>
</div>

<div class="page-break"></div>

</div>
                            <div class="item chapter">
    <h1 id="the-trefoil-interactive-plugins"><span>Chapter 5</span> The Trefoil interactive plugins</h1>
    <p class="has-dropcaps"><span class="dropcaps">T</span>his chapter describes the <em>interactive plugins</em>. These plugins
provide some interactive capabilities to ebooks, making them more 
appealing for textbooks or technical publications.</p>


    <div class="btn-group visible-xs visible-sm">

                
        <button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
            In this chapter:
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#autoglossaryplugin">
                            AutoGlossaryPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                            <li class="chapter level-2">
        <a href="#ebookquizplugin">
                            EbookQuizPlugin
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </ul>
    </div>


<h2 id="autoglossaryplugin">AutoGlossaryPlugin</h2>

<p>The <span class="auto-glossary-term"><a href="#auto-glossary-2696501299-auto-glossary-0" id="auto-glossary-term-2696501299-auto-glossary-0">auto-glossary</a></span> plugin handles the generation of a glossary of terms 
that are automatically hyperlinked to its definitions.</p>

<h3 id="availability-15">Availability</h3>

<p>This plugin is available for all editions.</p>

<h3 id="usage-15">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> AutoGlossary <span class="br0">&#93;</span><span class="co4">
                options</span>:<span class="co4">
                    AutoGlossary</span>:<span class="co3">
                        pagebreaks</span><span class="sy2">: </span>true  <span class="co1"># use pagebreaks between defined terms</span></pre>
</div>

<p>The terms&#8217; definitions are read from two files:</p>

<ul>
<li><strong>Global glossary:</strong> Contains the terms to be replaced into the whole book.</li>
<li><strong>Item glossary:</strong> Contains the terms to be replaced only into certain book item.</li>
</ul>

<p>The global glossary definition is called <code>auto-glossary.yml</code>:</p>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/Contents/auto-glossary.yml </span>
<span class="co1"># Global glossary definitions</span><span class="co4">
glossary</span>:<span class="co3">
    options</span><span class="sy2">: </span>
        <span class="co1"># 'all': all ocurrences</span>
        <span class="co1"># 'item': (default) only first ocurrence </span>
        <span class="co1">#         into an item (i.e. chapter)</span>
        <span class="co1"># 'first': first ocurrence in the whole book</span><span class="co3">
        coverage</span><span class="sy2">: </span>'item'
&nbsp;
        <span class="co1"># Elements to process (default: &quot;chapter&quot;)</span><span class="co3">
        elements</span><span class="sy2">: </span><span class="br0">&#91;</span><span class="st0">&quot;chapter&quot;</span><span class="br0">&#93;</span>
&nbsp;
    <span class="co1">####</span>
    <span class="co1"># Global definitions of terms:</span>
    <span class="co1">#</span>
    <span class="co1">#   &quot;term&quot;: Term definition</span>
    <span class="co1">#</span>
    <span class="co1"># Variants are allowed (singular, plural)</span>
    <span class="co1">#</span>
    <span class="co1">#   &quot;term[s]&quot;: Definition which is applied </span>
    <span class="co1">#              to &quot;term&quot; and &quot;terms&quot;</span>
    <span class="co1">#   &quot;term [one|two]&quot;: Definition which is </span>
    <span class="co1">#              applied to &quot;term one&quot; and &quot;term two&quot;</span>
    <span class="co1">####</span><span class="co3">
    terms</span><span class="sy2">: </span><span class="co3">
        &quot;term&quot;</span><span class="sy2">: </span>Definition</pre>
</div>

<p>The glossary definitions for each book item are named after the item it applies to 
(so the glossary for <code>chapter1.md</code> item should be <code>chapter1-auto-glossary.yml</code>)</p>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/Contents/chapter1-auto-glossary.yml </span>
<span class="co1"># Glossary definitions for chapter 1 </span><span class="co4">
glossary</span><span class="sy2">:
</span>    <span class="co1">####</span>
    <span class="co1"># Definitions of terms for chapter-1:</span>
    <span class="co1">#</span>
    <span class="co1">#   &quot;term&quot;: Term definition</span>
    <span class="co1">#</span>
    <span class="co1"># Variants are allowed (singular, plural)</span>
    <span class="co1">#</span>
    <span class="co1">#   &quot;term[s]&quot;: Definition which is applied </span>
    <span class="co1">#              to &quot;term&quot; and &quot;terms&quot;</span>
    <span class="co1">#   &quot;term [one|two]&quot;: Definition which is </span>
    <span class="co1">#              applied to &quot;term one&quot; and &quot;term two&quot;</span>
    <span class="co1">####</span><span class="co3">
    terms</span><span class="sy2">: </span><span class="co3">
        &quot;term&quot;</span><span class="sy2">: </span>Definition</pre>
</div>

<h3 id="description-15">Description</h3>

<p>Depending on the coverage options, each ocurrence (or only the first one) of a defined
term is replaced by an hyperlink to its definition.</p>

<p>The <span class="auto-glossary-term"><a href="#auto-glossary-2794359480-glossary-terms-0" id="auto-glossary-term-2794359480-glossary-terms-0">glossary term</a></span> definitions are of the form <code>"term": Term definition</code>, where each
&#8220;term&#8221; can be either a <em>literal expresion</em> or a <em>variant expression</em>:</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">glossary</span>:<span class="co3">
    terms</span><span class="sy2">: </span>
        <span class="co1"># literal expression</span><span class="co3">
        &quot;Lorem ipsum&quot;</span><span class="sy2">: </span>Pseudo-latin text used as filler or dummy text.
&nbsp;
        <span class="co1"># variant expressions </span><span class="co3">
        &quot;car[s]&quot;</span><span class="sy2">: </span>Definition which is applied to <span class="st0">&quot;car&quot;</span> and <span class="st0">&quot;cars&quot;</span><span class="co3">
        &quot;orange [car|truck]&quot;</span><span class="sy2">: </span>Definition which is applied to <span class="st0">&quot;orange car&quot;</span> and <span class="st0">&quot;orange truck&quot;</span></pre>
</div>

<p>Using variants is possible to create defintitions that cover several cases (like singular
and plural of a word or expression).</p>

<p>The <strong>global glossary definitions</strong> file also have an <code>options</code> section with several values
that affect how the glossary terms are processed:</p>

<ul>
<li><p><code>glossary.options.coverage</code> defines how many ocurrences of a term will be converted into
glossary items links:</p>

<ul>
<li><code>all</code>: all ocurrences in the book.</li>
<li><code>item</code>: (default) only the first ocurrence inside a content item.</li>
<li><code>first</code>: only the first ocurrence in the whole book.</li>
</ul></li>
<li><p><code>elements</code> is a list of all element types to be processed. By default only <code>chapter</code> items
are processed.</p></li>
</ul>

<p><strong>Example:</strong></p>

<ul>
<li>This paragraph contains the expressions &#8220;<span class="auto-glossary-term"><a href="#auto-glossary-1435020988-example-term-1-0" id="auto-glossary-term-1435020988-example-term-1-0">example term 1</a></span>&#8221; and &#8220;<span class="auto-glossary-term"><a href="#auto-glossary-138462274-example-term-2-0" id="auto-glossary-term-138462274-example-term-2-0">example term 2</a></span>&#8221; that should
be converted into glossary terms.</li>
</ul>

<div class="admonition note">
  <h5 id="note-10">Note</h5>
  
  <p>While this autoglossary implementation can <em>potentially</em> work for every edition type, 
  whether it really does work depends mostly on the <em>reader platform</em> capabilities:</p>
  
  <ul>
  <li><strong>Epub:</strong>: Some readers can follow hyperliks, but most do not.</li>
  <li><strong>Kindle:</strong> The Kindle readers can follow hyperlinks and do page breaks. It works OK.</li>
  <li><strong>PDF:</strong> It depends. The official <em>Adobe Reader</em> is OK, but other implementations may vary.</li>
  <li><strong>HTML:</strong> No problems.</li>
  </ul>
  
  <p>But, as this implementation is mostly focused on <strong>ebooks</strong>, even if it produces a clickable 
  autoglossary it may not give the best results on a printed edition.</p>
</div>

<div class="admonition note">
  <h5 id="todo-2">TODO</h5>
  
  <p>Create an adequate implementation for editions different from <code>epub</code> and <code>mobi</code> (like this one).</p>
</div>

<h3 id="output-5">Output</h3>

<p>The plugin will generate a report in the output directory called <code>report-AutoGlossaryPlugin.txt</code>
with a summary of terms processed and problems found.</p>

<div class="page-break"></div>

<h2 id="ebookquizplugin">EbookQuizPlugin</h2>

<p>The quiz plugin allows adding interactive test functionality to an ebook 
(mainly for <em>epub</em> or <em>mobi</em> formats, read below note on compatibility).</p>

<h3 id="availability-16">Availability</h3>

<p>This plugin is available for all editions (read below note on compatibility).</p>

<h3 id="usage-16">Usage</h3>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name&gt;<span class="co4">
            plugins</span>:<span class="co3">
                enabled</span><span class="sy2">: </span><span class="br0">&#91;</span> EbookQuiz <span class="br0">&#93;</span>                <span class="co4">
                options</span>:<span class="co4">
                    EbookQuiz</span>:<span class="co4">
                        ynb</span>:<span class="co3">
                            yes</span><span class="sy2">: </span><span class="br0">&#91;</span> '<span class="kw1">Yes</span>', 'True' <span class="br0">&#93;</span><span class="co3">
                            no</span><span class="sy2">: </span><span class="br0">&#91;</span> '<span class="kw1">No</span>', 'False' <span class="br0">&#93;</span><span class="co3">
                            both</span><span class="sy2">: </span><span class="br0">&#91;</span> 'Both' <span class="br0">&#93;</span></pre>
</div>

<h3 id="description-16">Description</h3>

<p>This plugin allows creating an ebook with some interactive
functions, like a question-response test where the user is presented with a set
of questions, each one with a number of predefined responses in the form of 
hyperlinks. The user &#8220;cliks&#8221; on one response and the &#8220;system&#8221; tells him
if he has selected the right answer.</p>

<p>First of all, lets define the scope of our solution:</p>

<h4 id="target-platforms">Target platforms</h4>

<p>The solution MUST work on <em>Amazon Kindle</em> readers compatible with the new <em>KF8</em> format. 
It MAY also work in another platforms (even with reduced functionality), but the
<em>Amazon Kindle</em> readers are the main target.</p>

<p>The problem is that the <em>KF8</em> format does not allow any kind of interactivity 
other than plain-old hyperlinks (no javascript or another client-side language),
so we need to circumvent the limitation and find another way to do it.</p>

<h4 id="types-of-tests">Types of tests</h4>

<p>A &#8220;Quiz&#8221; is an interactive test. There are two types of quizes:</p>

<ul>
<li><p><strong>Multiple questions / single answer</strong>, like &#8220;A: first response&#8221;, &#8220;B: second response&#8221;
and so on. An especial subtype is a &#8220;True/False&#8221; test, where the only allowed
responses are either &#8220;True&#8221; of &#8220;False&#8221; (with an optional &#8220;Both&#8221;). These types will be
referred to as &#8220;ABC&#8221; and &#8220;YNB&#8221; respectively.</p></li>
<li><p><strong>Questionnaire</strong>, where the user is presented with a series of questions that 
do not have a predefined set of responses but require elaboration or reasoning. 
When the user has created its own response he can select an option to &#8220;reveal&#8221; the
right answer.</p></li>
</ul>

<h4 id="technical-requirements">Technical requirements</h4>

<p>As the main target is the <em>Amazon Kindle</em> readers that use KF8 format (basically, a 
subset of EPUB3, more information here: <a href="http://wiki.mobileread.com/wiki/KF8">http://wiki.mobileread.com/wiki/KF8</a>) the 
solution must stick to be just HTML + CSS (without any scripting language).</p>

<p>Another self-imposed constraint is that the solution must respect the <em>Markdown</em> spirit,
where the unparsed text is readable by humans. So no extraneous or made-up syntax will
be used, only standard <em>Markdown</em> features.</p>

<h4 id="implementation">Implementation</h4>

<p>All types of quizes will be implemented as standard <em>Markdown</em> syntax with a predefined
structure. This structure is also easily readable and just &#8220;makes sense&#8221;, so even if
the book doesn&#8217;t enable this plugin the resulting ebook will be valid (but without the
interactive features, of course).</p>

<h4 id="syntax-of-a-quiz">Syntax of a quiz</h4>

<p>The different quiz types share a common syntax, with the following remarks:</p>

<ul>
<li><p>The whole quiz markup is enclosed in an HTML <code>&lt;div&gt;</code> block. This is totally allowed
by <em>Markdown</em> and allows the quiz to be parsed effectively by the plugin:</p>

<p><code>&lt;div markdown="1" class="quiz-xxxxx" data-id="xxxxx"&gt;...&lt;/div&gt;</code></p>

<ul>
<li><p>The <code>markdown="1"</code> attribute is needed in order for the contents to be processed by 
the <em>Markdown</em> parser.</p></li>
<li><p>The <code>class="quiz-xxxxx"</code> tells the plugin parser the quiz type that follows. Allowed
values are <code>quiz-activity</code> and <code>quiz-questionnaire</code>.  The parser will automatically 
decide if a &#8220;quiz-activity&#8221; is of type &#8220;ABC&#8221; or &#8220;YBN&#8221; (more on that later).</p></li>
<li><p>The <code>data-id="xxxxx"</code> attribute assigns an unique id to this quiz.</p></li>
</ul></li>
<li><p>The markup itself has a few optional parts. If not provided they will be left blank 
in the quiz rendering or assigned sensible defaults.</p></li>
<li><p>The questions are represented by an ordered list, and the responses with another 
embedded ordered list. The correct response to each question must be denoted with 
<strong>bold</strong> format.</p></li>
<li><p>Please note that the quiz markup MUST be correctly parsable by <em>Markdown</em> or the plugin
will be unable to process it.</p></li>
<li><p>For the interactive solutions to be rendered, a book element of type &#8220;ebook-quiz-solution&#8221;
must be present at the end of the book.</p></li>
</ul>

<h4 id="compatibility-notes">Compatibility notes</h4>

<ul>
<li><p>The generated quizes will only work on <em>Amazon Kindle</em> devices or applications
with KF8 capabilities (this includes the <em>Kindle 4</em> devices onwards).</p></li>
<li><p><code>KindleTweaksPlugin</code> interferes with this plugin. Do not enable it if you use
this plugin.</p></li>
</ul>

<h3 id="examples-2">Examples</h3>

<h4 id="abc-type-quiz-syntax">ABC-type quiz syntax</h4>

<div class="code markdown"><pre>
&lt;div markdown="1" class="quiz-activity" data-id="quiz-id-1">
##### Activity 1 heading
###### Activity subheading (optional).

Activity description (optional). Lorem ipsum dolor sit amet, 
consetetur sadipscing elitr, sed diam non umyeirmod.

1. First question.
    
    1. **First response.**
    2. Second response.
    3. Third response.

2. Second question.
    
    1. First response.
    2. **Second response**.
        
        This is an optional explanation.
        
        Lorem ipsum dolor sit amet, consetetur 
        sadipscing elitr, sed diam nonumyeirmod 
        tempor invidunt ut labore et dolore magna 
        aliquyam erat, sed diamvoluptua. 
    
    3. Third response.
    4. Fourth response.
  
&lt;/div>
</pre></div>

<h4 id="ynb-type-quiz-syntax">YNB-type quiz syntax</h4>

<div class="code markdown"><pre>
&lt;div markdown="1" class="quiz-activity" data-id="quiz-id-2">
##### Activity 2 heading
###### Activity subheading (optional).

Activity description (optional). Lorem ipsum dolor sit amet, 
consetetur sadipscing elitr, sed diam non umyeirmod.

1. First question.

    1. **True**
    
        This is the correct response (true).
    
    2. False

2. Second question.

    1. True
    2. **False**
        
        This is the correct response (false).
    
&lt;/div>
</pre></div>

<h4 id="questionnaire-type-quiz-syntax">Questionnaire-type quiz syntax</h4>

<div class="code markdown"><pre>
&lt;div markdown="1" class="quiz-questionnaire" data-id="quiz-id-3" >
##### Questionnaire 1 heading
###### Questionnaire subheading (optional).

Questionnaire description (optional). Lorem ipsum dolor sit amet, 
consetetur sadipscing elitr, sed diam non umyeirmod.

1. First question.

  ###### Solution
    
    The solution to the first question (optional).

2. Second question.

3. Third question.

  ###### Solution
    
    The solution to the third question (optional).

&lt;/div>
</pre></div>

<h3 id="rendered-examples">Rendered examples</h3>

<p>The quizes shown above as examples will render as follows:</p>

<div class="admonition note">
  <h5 id="note-11">NOTE</h5>
  
  <p>The following rendered version of the examples is not the same
  than the one you will get for an <code>epub</code> or <code>mobi</code> ebook 
  because of the limited capabilities of the format. 
  Main differences are:</p>
  
  <ul>
  <li>The <code>epub</code> or <code>mobi</code> versions are rendered using only HTML.</li>
  <li>This version uses Javascript to implement the user interactions.</li>
  </ul>
  
  <p>Please generate the <code>epub</code> or <code>mobi</code> versions of this documentation
  to fully appreciate the differences.</p>
</div>

<h4 id="abc-type-quiz-syntax-2">ABC-type quiz syntax</h4>

<!--
========================================
Activity: quiz-id-1
Type....: activity.abc
========================================
-->
<div class="panel panel-primary activity activity-activity.abc">

    
    <div class="panel-heading">
        <h5 class="panel-title">Activity 1 heading</h5>
    
                    <h6>Activity subheading (optional).</h6>
            
                    <div class="introduction"><p>Activity description (optional). Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam non umyeirmod.</p></div>
            </div>

    <div class="panel-body">
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="panel-title question"><span class="label label-default number">1</span></h6>
                <div class="question"><p>First question.</p></div>
            </div> 
            <div class="panel-body">
                                                                                <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_0_0_resp">
                                A
                            </button>
    
                            &nbsp;First response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_0_0_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">First response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-success">Correct!!</span></h2>
                                                                                        
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                            <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_0_1_resp">
                                B
                            </button>
    
                            &nbsp;Second response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_0_1_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">Second response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-danger">Wrong</span></h2>
                                                                                        
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                            <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_0_2_resp">
                                C
                            </button>
    
                            &nbsp;Third response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_0_2_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">Third response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-danger">Wrong</span></h2>
                                                                                        
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                                </div>
        </div>
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="panel-title question"><span class="label label-default number">2</span></h6>
                <div class="question"><p>Second question.</p></div>
            </div> 
            <div class="panel-body">
                                                                                <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_1_0_resp">
                                A
                            </button>
    
                            &nbsp;First response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_1_0_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">First response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-danger">Wrong</span></h2>
                                                                                        
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                            <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_1_1_resp">
                                B
                            </button>
    
                            &nbsp;Second response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_1_1_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">Second response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-success">Correct!!</span></h2>
                                                                                        <p>This is an optional explanation.</p><p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumyeirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diamvoluptua.</p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                            <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_1_2_resp">
                                C
                            </button>
    
                            &nbsp;Third response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_1_2_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">Third response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-danger">Wrong</span></h2>
                                                                                        
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                            <p class="response">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#a-quiz-id-1_1_3_resp">
                                D
                            </button>
    
                            &nbsp;Fourth response.
                            
                                                            
                            <div class="modal fade bs-modal-s" id="a-quiz-id-1_1_3_resp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">Fourth response.</h4>
                                        </div>
                                        <div class="modal-body">
                                                                                            <h2><span class="label label-danger">Wrong</span></h2>
                                                                                        
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </p>
                                                </div>
        </div>
        </div>
</div>



<h4 id="ynb-type-quiz-syntax-2">YNB-type quiz syntax</h4>

<!--
========================================
Activity: quiz-id-2
Type....: activity.ynb
========================================
-->
<div class="panel panel-primary activity activity-activity.ynb">

    
    <div class="panel-heading">
        <h5 class="panel-title">Activity 2 heading</h5>
    
                    <h6>Activity subheading (optional).</h6>
            
                    <div class="introduction"><p>Activity description (optional). Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam non umyeirmod.</p></div>
            </div>

    <div class="panel-body">
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="panel-title question"><span class="label label-default number">1</span></h6>
                <div class="question"><p>First question.</p></div>
            </div> 
            <div class="panel-body">
                                                            <button type="button" class="btn btn-success" data-toggle="modal"
                                data-target="#a-quiz-id-2_0_0_resp">
                            <span>True</span>
                        </button>
    
                                                                        
                        <div class="modal fade bs-modal-s" id="a-quiz-id-2_0_0_resp" tabindex="-1" role="dialog"
                             aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"
                                                aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="myModalLabel">True</h4>
                                    </div>
                                    <div class="modal-body">
                                                                                    <h2><span class="label label-success">Correct!!</span></h2>
                                                                                <p>This is the correct response (true).</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                                            <button type="button" class="btn btn-danger" data-toggle="modal"
                                data-target="#a-quiz-id-2_0_1_resp">
                            <span>False</span>
                        </button>
    
                                                                        
                        <div class="modal fade bs-modal-s" id="a-quiz-id-2_0_1_resp" tabindex="-1" role="dialog"
                             aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"
                                                aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="myModalLabel">False</h4>
                                    </div>
                                    <div class="modal-body">
                                                                                    <h2><span class="label label-danger">Wrong</span></h2>
                                                                                
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                                                </div>
        </div>
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="panel-title question"><span class="label label-default number">2</span></h6>
                <div class="question"><p>Second question.</p></div>
            </div> 
            <div class="panel-body">
                                                            <button type="button" class="btn btn-success" data-toggle="modal"
                                data-target="#a-quiz-id-2_1_0_resp">
                            <span>True</span>
                        </button>
    
                                                                        
                        <div class="modal fade bs-modal-s" id="a-quiz-id-2_1_0_resp" tabindex="-1" role="dialog"
                             aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"
                                                aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="myModalLabel">True</h4>
                                    </div>
                                    <div class="modal-body">
                                                                                    <h2><span class="label label-danger">Wrong</span></h2>
                                                                                
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                                            <button type="button" class="btn btn-danger" data-toggle="modal"
                                data-target="#a-quiz-id-2_1_1_resp">
                            <span>False</span>
                        </button>
    
                                                                        
                        <div class="modal fade bs-modal-s" id="a-quiz-id-2_1_1_resp" tabindex="-1" role="dialog"
                             aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"
                                                aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="myModalLabel">False</h4>
                                    </div>
                                    <div class="modal-body">
                                                                                    <h2><span class="label label-success">Correct!!</span></h2>
                                                                                <p>This is the correct response (false).</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                                                </div>
        </div>
        </div>
</div>



<h4 id="questionnaire-type-quiz-syntax-2">Questionnaire-type quiz syntax</h4>

<!--
========================================
Questionnaire: quiz-id-3
========================================
-->
<div class="panel panel-primary questions">

    
    <div class="panel-heading">
        <h5 class="panel-title">Questionnaire 1 heading</h5>
    
                    <h6>Questionnaire subheading (optional).</h6>
            
                    <div class="introduction"><p>Questionnaire description (optional). Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam non umyeirmod.</p></div>
            </div>

    <div class="panel-body">
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="question"><span class="label label-default number">1</span></h6>
                <div class="question"><p>First question.</p></div>
            </div>
            <div class="panel-body">
                                    <button type="button" class="btn btn-warning" data-toggle="modal"
                            data-target="#q-quiz-id-3_0-solution-resp">
                        View solution
                    </button>

                    <div class="modal fade bs-modal-s" id="q-quiz-id-3_0-solution-resp" tabindex="-1" role="dialog"
                         aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal"
                                            aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModalLabel">Solution</h4>
                                </div>
                                <div class="modal-body">
                                    <p>The solution to the first question (optional).</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                            </div>
        </div>
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="question"><span class="label label-default number">2</span></h6>
                <div class="question"><p>Second question.</p></div>
            </div>
            <div class="panel-body">
                                    <p class="response">Ask your teacher to provide the solution.</p>
                            </div>
        </div>
            
        <div class="panel panel-success">
            <div class="panel-heading">
                <h6 class="question"><span class="label label-default number">3</span></h6>
                <div class="question"><p>Third question.</p></div>
            </div>
            <div class="panel-body">
                                    <button type="button" class="btn btn-warning" data-toggle="modal"
                            data-target="#q-quiz-id-3_2-solution-resp">
                        View solution
                    </button>

                    <div class="modal fade bs-modal-s" id="q-quiz-id-3_2-solution-resp" tabindex="-1" role="dialog"
                         aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal"
                                            aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModalLabel">Solution</h4>
                                </div>
                                <div class="modal-body">
                                    <p>The solution to the third question (optional).</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                            </div>
        </div>
        </div>
</div>


<div class="page-break"></div>

</div>
                            <div class="item part">
    <h1 id="trefoil-themes"><span>Part 3</span> Trefoil themes</h1>
    <p><strong>trefoil</strong> greatly enhances the functionality of <strong>easybook</strong> themes.</p>

</div>
                            <div class="item chapter">
    <h1 id="themes-system-enhancements"><span>Chapter 6</span> Themes system enhancements</h1>
    <p class="has-dropcaps"><span class="dropcaps">T</span>hemes functionality has been greatly enhanced in <strong>trefoil</strong>, 
making them more flexible and easy to customize. Also, <strong>trefoil</strong> 
themes can provide not only CCS styles and HTML templates but 
also images and fonts.</p>


    <div class="btn-group visible-xs visible-sm">

                
        <button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
            In this chapter:
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
                                                                                                                                                                                                                                                                    <li class="chapter level-2">
        <a href="#trefoil-themes-2">
                            Trefoil themes
                    </a>
    </li>

                                                                                                                                                                                                                                            <li class="chapter level-2">
        <a href="#custom-themes">
                            Custom themes
                    </a>
    </li>

                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#structure-of-a-theme">
                            Structure of a theme
                    </a>
    </li>

                                                                                                                                                                                                                <li class="chapter level-2">
        <a href="#components-of-a-theme">
                            Components of a theme
                    </a>
    </li>

                                                                                                                                                                                                                                                                                                                                                                                                                        </ul>
    </div>


<h2 id="trefoil-themes-2">Trefoil themes</h2>

<p><strong>trefoil</strong> comes with some standard themes:</p>

<ul>
<li><p><code>TrefoilOne</code> is a classic-looking theme, suitable for novels, 
essays and other literary works.</p></li>
<li><p><code>TrefoilTwo</code> is a modern theme. This book uses it.</p></li>
</ul>

<p>To use them, as always, just put the name of the theme in the 
book&#8217;s <code>config.yml</code>:</p>

<div class="code yaml">
<pre class="yaml"><span class="co1"># &lt;book-dir&gt;/config.yml </span><span class="co4">
book</span><span class="sy2">:
</span>    <span class="sy1">...</span>.<span class="co4">
    editions</span><span class="sy2">:
</span>        &lt;edition-name<span class="sy2">&gt;
</span>            <span class="sy1">...</span><span class="co3">
            theme</span><span class="sy2">: </span>TrefoilTwo</pre>
</div>

<p>The theme definitions will be looked up into <code>&lt;trefoil-dir&gt;/app/Resources/Themes</code>. 
If the theme is not found there, <strong>trefoil</strong> will try to use an 
standard <strong>easybook</strong> theme of the same name. If that is also missing, 
the standard <code>Base</code> theme will be used, which is likely to cause 
problems if you activated some plugin that requires a non-standard template.</p>

<div class="admonition note">
  <h5 id="note-12">Note</h5>
  
  <p><strong>trefoil</strong> themes are backwards-compatible with <strong>easybook</strong> themes, 
  meaning that any book that can be published by <strong>easybook</strong> can also be
  published by <strong>trefoil</strong>. Of course, you will need to use an <strong>trefoil</strong>
  theme to make use of its new features.</p>
</div>

<h2 id="custom-themes">Custom themes</h2>

<p><strong>trefoil</strong> allows creating custom themes. Their structure is the same than 
the standard <strong>trefoil</strong> themes but can be created anywhere in the file system, 
allowing the creation of a personal theme library without the need to modify 
the <strong>trefoil</strong> <code>app/Resources</code> directory.</p>

<p>To use a custom theme you just need to invoke the <code>book publish</code> command with 
the new optional argument <code>--themes_dir</code>:</p>

<div class="code bash">
<pre class="bash">book publish my-book-slug my-edition --themes_dir=..<span class="sy0">/</span>my<span class="sy0">/</span>themes<span class="sy0">/</span>directory</pre>
</div>

<p>Example:</p>

<div class="code bash">
<pre class="bash">book publish the-origin-of-species ebook --themes_dir=~<span class="sy0">/</span>themes<span class="sy0">/</span>trefoil</pre>
</div>

<h2 id="structure-of-a-theme">Structure of a theme</h2>

<p>A theme, whether standard or custom, must follow this structure:</p>

<div class="code code">
<pre class="code">&lt;themes-dir&gt;
 &lt;theme-name&gt;
    Common      &lt;== Common definitions
     Contents    
     Resources
      Fonts
      images
     Templates
    &lt;edition-type1&gt;  &lt;== For edition type 1
     Contents
     Resources
      images
      Translations
     Templates
     ...
    &lt;edition-typeN&gt;  &lt;== For edition type N
       Contents
       Resources
        images
        Translations
       Templates</pre>
</div>

<div class="admonition note">
  <h5 id="note-13">Note</h5>
  
  <p>Standard <strong>trefoil</strong> themes do not support all the edition types, 
  but <code>epub</code> and <code>mobi</code> are available in each theme (please
  look at each theme directory to find out which ones are available).
  But you are free to implement support for other edition types in your 
  custom themes.</p>
</div>

<h2 id="components-of-a-theme">Components of a theme</h2>

<h3 id="contents">Contents</h3>

<ul>
<li><p><code>Common\Contents</code> directory contains default content for book items that 
are common to all editions.</p></li>
<li><p><code>&lt;edition-type&gt;\Contents</code> directory contain content that is specific to 
that edition.</p></li>
</ul>

<p>If a content file is not found into one of these directories it will be 
looked up into the standard <strong>easybook</strong> content directories (most likely, 
the <code>Base</code> theme).</p>

<h3 id="fonts">Fonts</h3>

<ul>
<li><code>Common\Resources\Fonts</code> directory contains additional font files for the book.</li>
</ul>

<p>There is no per-edition font directory, but you can select which fonts are
packed into the final book for a given edition with the following configuration:</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">book</span>:<span class="co4">
    editions</span>:<span class="co4">
        &lt;edition-name&gt;</span>:<span class="co3">
            include_fonts</span><span class="sy2">: </span> true<span class="co3">
            fonts</span><span class="sy2">: </span>
                - Inconsolata-Regular
                - Inconsolata-Bold</pre>
</div>

<p>Only the listed font files will be included into the final ebook (i.e. <code>book.epub</code>). 
This is a useful technique for limiting the final size of an edition output by only 
including the needed fonts.</p>

<h3 id="templates">Templates</h3>

<ul>
<li><code>Common\Templates</code> directory contains templates that are common to all editions. </li>
<li><code>&lt;edition-type&gt;\Templates</code> directory contain templates specific to that edition.</li>
</ul>

<h3 id="images">Images</h3>

<ul>
<li><code>Common\Resources\images</code> directory contains images that are common to all editions. </li>
<li><code>&lt;edition-type&gt;\Resources\images</code> directory contain images specific to that edition.</li>
</ul>

<p>You can organize the image files into whatever subdirectories structure inside the 
<code>images</code> directories. Upon book publishing, all of them will be copied to a flat 
<code>images</code> files into the book contents (so beware of duplicated names). Images 
per-edition type overwrite common images of the same name.</p>

<h3 id="translations">Translations</h3>

<ul>
<li><p><code>Common\Resources\Translations</code> directory contains label files that are common 
to all editions.</p></li>
<li><p><code>&lt;edition-type&gt;\Resources\Translations</code> directory contain label files specific to 
that edition.</p></li>
</ul>

<p>As usual, per-edition translations overwrite common translations.</p>

</div>
                            <div class="item footnotes">
    <h1 id="footnotes"><span></span> Footnotes</h1>

    <p>The next pages contain the footnotes referred from the text.</p>

<p>To return to the text, please &#8220;click&#8221; on the return link of each note.</p>


    <hr />
    <ol>
        <li id="fn-note1">
        <p>This is a footnote just for showing an example.&#160;<a href="#fnref-note1" rev="footnote" class="footnote-backref">[&#8617;]</a></p>
    </li>
        <li id="fn-note2">
        <p>Another footnote, also with dummy text just to have something to work with .&#160;<a href="#fnref-note2" rev="footnote" class="footnote-backref">[&#8617;]</a></p>
    </li>
        </ol>
</div>

                            <div class="item auto-glossary">
    <h1 id="glossary"><span></span> Glossary</h1>

    <p>The next pages contain several definitions for certain terms found in the text.</p>

<p>To return to the text, please &#8220;click&#8221; on the return link of each term.</p>


    <hr />

            
        <div class="definition" id="auto-glossary-2696501299-auto-glossary-0">
            <dl>
                <dt class="definition">auto-glossary</dt>
                <dd class="description">A glossary generated automatically.&#160;<a class="backlink" href="#auto-glossary-term-2696501299-auto-glossary-0">[&#8617;]</a>
                </dd>
            </dl>

        </div>

                    
        <div class="definition" id="auto-glossary-2794359480-glossary-terms-0">
            <dl>
                <dt class="definition">glossary term</dt>
                <dd class="description">A word or expression to be defined as part of a glossary.&#160;<a class="backlink" href="#auto-glossary-term-2794359480-glossary-terms-0">[&#8617;]</a>
                </dd>
            </dl>

        </div>

                    
        <div class="definition" id="auto-glossary-1435020988-example-term-1-0">
            <dl>
                <dt class="definition">example term 1</dt>
                <dd class="description">Description of term 1.&#160;<a class="backlink" href="#auto-glossary-term-1435020988-example-term-1-0">[&#8617;]</a>
                </dd>
            </dl>

        </div>

                    
        <div class="definition" id="auto-glossary-138462274-example-term-2-0">
            <dl>
                <dt class="definition">example term 2</dt>
                <dd class="description">Description of term 2.&#160;<a class="backlink" href="#auto-glossary-term-138462274-example-term-2-0">[&#8617;]</a>
                </dd>
            </dl>

        </div>

            
</div>

                            
                    </div>
    </div>
</div>

</body>
</html>
